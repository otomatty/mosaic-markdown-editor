# 実装計画書: Mosaic Markdown Editor

この計画書は、Lichtblickプロジェクトで使われている技術スタックを習得することを目標とした、多機能Markdownエディタの開発ロードマップです。

## 1. プロジェクト概要

- **プロジェクト名:** Mosaic Markdown Editor
- **目的:** ElectronとモダンなWeb技術（React, MUI, TypeScript等）を組み合わせたデスクトップアプリ開発スキルを実践的に習得する。
- **コア機能:**
    - Markdownの編集とリアルタイムプレビュー機能
    - `React Mosaic`による分割・リサイズ可能なパネルレイアウト
    - ネイティブファイル操作（開く、保存、ドラッグ＆ドロップ）
    - `MUI`と`TSS-React`によるモダンなUI構築
- **高度な機能（フェーズ5）:**
    - ユーザー定義テンプレート機能
    - カスタムカラーテーマ作成・管理
    - 統合設定画面
    - Markdownタスク管理（カンバン形式）
    
## 2. 開発フェーズ

### 🎯 現在の状況（2025年1月10日時点）
- **完了フェーズ:** フェーズ1, フェーズ2, フェーズ3, フェーズ4-1（国際化実装）, フェーズ4-2（新規ファイル作成機能）, フェーズ4-3（設定永続化機能）, フェーズ4-4（ショートカットヘルプ機能）, フェーズ5-1（テンプレート機能）, フェーズ5-2（テンプレート管理機能）
- **進行中フェーズ:** フェーズ5-3（統合設定画面）
- **最新完了:** テンプレート管理機能の実装
- **次のタスク:** 統合設定画面、カラーテーマ切り替え機能
- **新規追加:** フェーズ5（高度な機能実装）の計画追加
- **全体進捗:** 約90%完了（高度な機能実装により調整）

### 📋 完了済み機能
- ✅ MUI + TSS-React基盤UI
- ✅ Electron IPC通信（ファイル操作）
- ✅ テキストエディタ（未保存変更トラッキング）
- ✅ Markdownリアルタイムプレビュー
- ✅ コンポーネント分割リファクタリング
- ✅ React Mosaic動的パネルレイアウト
- ✅ ドラッグ&ドロップファイル操作
- ✅ 国際化(i18n) - 日本語・英語対応
- ✅ 新規ファイル作成機能 - エディタ自動表示
- ✅ 設定永続化機能 - ウィンドウ・レイアウト・言語設定
- ✅ ショートカットヘルプ機能 - F1キー・ヘルプボタン対応
- ✅ テンプレート機能 - 選択・適用・プレビュー
- ✅ テンプレート管理機能 - 作成・編集・削除・検索
- ✅ 型安全なTypeScript実装

### フェーズ1: 基盤構築とUIセットアップ（✅ 完了）
- **目標:** アプリの基本ウィンドウを表示し、MUIとTSS-ReactでUIの骨格を構築する。
- **主要タスク:**
    1. - [x] `electron-vite`でプロジェクトを作成する。
    2. - [x] 必要なUIライブラリ (`@mui/material`, `tss-react`等) をインストールする。[必要なライブラリ](./phase1_libraries-install.md)
    3. - [x] `App.tsx`を編集し、MUIの`ThemeProvider`, `CssBaseline`, `AppBar`を配置する。[実装詳細](./phase1-2_mui-setup.md)
    4. - [x] `TSS-React`の`makeStyles`でAppBarにスタイルを適用する。[実装詳細](./phase1-2_mui-setup.md)
    5. - [x] `yarn dev`で動作確認し、基本的なUIが表示されることを確認する。[実装詳細](./phase1-2_mui-setup.md)

### フェーズ2: Electronの核心 - ファイルI/Oの実装（✅ 完了）
- **目標:** メインプロセスとレンダラープロセス間の安全な通信（IPC）を理解し、基本的なファイル操作（開く/保存）を実装する。
- **主要タスク:**
    1. - [x] **型定義作成:** TypeScript型定義ファイルを作成し、型安全なAPI設計を実装。[実装詳細](./phase2-1_type-definitions.md)
    2. - [x] **プリロードスクリプト:** `contextBridge`を使い、レンダラーに公開するAPI (`window.electronAPI`)を定義。[実装詳細](./phase2-2_preload-implementation.md)
    3. - [x] **メインプロセス:** `ipcMain.handle`で非同期リクエストを待ち受け、OSダイアログとファイル操作を実装。[実装詳細](./phase2-3_main-process-ipc.md)
    4. - [x] **レンダラープロセス:** ファイルメニューUI実装と`window.electronAPI`の関数呼び出し。[実装詳細](./phase3-1_file-menu-implementation.md)

### フェーズ3: 高度なUI - パネルレイアウトとリアルタイムプレビュー（✅ 完了）
- **目標:** `React Mosaic`で分割パネルを、`React DnD`でファイルドロップを実装し、アプリのコア機能を完成させる。
- **主要タスク:**
    1. - [x] **テキストエディタ実装:** フルスクリーンテキストエディタと未保存変更トラッキング。[実装詳細](./phase3-2_text-editor-implementation.md)
    2. - [x] **Markdownプレビュー:** `marked`を使用したリアルタイムプレビュー機能。[実装詳細](./phase3-3_markdown-preview-implementation.md)
    3. - [x] **コンポーネントリファクタリング:** App.tsxの分割と保守性向上。[実装詳細](./phase3-4_component-refactoring.md)
    4. - [x] **React Mosaic導入:** 分割・リサイズ可能なパネルレイアウトの実装。[実装詳細](./phase3-5_react-mosaic-implementation.md)
    5. - [x] **ドラッグ&ドロップ:** `React DnD`を使用したファイルドロップ機能。[実装詳細](./phase3-6_drag-drop-implementation.md)

### フェーズ4: アプリケーションの完成度向上（🚧 部分完了）
- **目標:** 多言語対応や設定保存機能を実装し、より実用的なアプリケーションに近づける。
- **主要タスク:**
    1. - [x] **国際化(i18n):** `react-i18next`を導入し、UIのテキストを日本語/英語で切り替えられるようにする。[実装詳細](./phase4-1_i18n-implementation.md)
    2. - [x] **新規ファイル作成:** 空のMarkdownファイルを新規作成する機能を実装する。[実装詳細](./phase4-2_new-file-creation.md)
    3. - [x] **設定の永続化:** `electron-store`を導入し、ウィンドウサイズや位置、選択中の言語などをアプリ終了後も保持できるようにする。[実装詳細](./phase4-3_electron-store-implementation.md)

### フェーズ5: 高度な機能実装
- **目標:** より実用的で高度な機能を実装し、プロフェッショナルなMarkdownエディタとして完成させる。
- **主要タスク:**
    1. - [x] **テンプレート機能**: ユーザー定義テンプレートの作成・管理・利用機能
        - ✅ テンプレートの作成・編集・削除機能
        - ✅ テンプレートのカテゴリ分類（8つのカテゴリ）
        - ✅ テンプレートのプレビュー機能
        - ✅ 新規ファイル作成時のテンプレート選択
        - ✅ テンプレートの検索・フィルタリング機能
        - ✅ 完全なCRUD操作（作成・読み取り・更新・削除）
        - ✅ テンプレート管理ダイアログ（736行）
        - ✅ 国際化対応（日本語・英語）
        - ✅ 型安全なTypeScript実装
        - ✅ Electron IPC統合（8つのAPI）
    2. - [ ] **カラーテーマ切り替え機能**: カスタムテーマの作成・編集・適用機能
        - プリセットカラーテーマの追加（GitHub、VS Code、Solarized等）
        - カスタムテーマエディタの実装
        - テーマのインポート・エクスポート機能
        - リアルタイムプレビュー機能
        - テーマの共有・配布機能
    3. - [ ] **統合設定画面**: 全設定を一元管理する設定ダイアログ
        - タブ形式の設定画面UI
        - 一般設定（言語、テーマ、ウィンドウ）
        - エディタ設定（フォント、インデント、折り返し）
        - プレビュー設定（スタイル、同期スクロール）
        - 高度な設定（キーバインド、プラグイン）
        - 設定のリセット・インポート・エクスポート機能
    4. - [ ] **タスク管理機能**: Markdownタスクリストのカンバン形式表示・管理機能
        - Markdownファイルからタスクリストの自動抽出
        - カンバン形式のタスクボード表示
        - タスクのドラッグ&ドロップによる状態変更
        - タスクの進捗管理（TODO、進行中、完了）
        - タスクの優先度設定とフィルタリング
        - タスクの期限設定と通知機能

### フェーズ6: ビルドと配布
- **目標:** `electron-builder`を使い、クロスプラットフォーム（macOS, Windows, Linux）で動作する配布可能なインストーラーを作成する。
- **主要タスク:**
    1. - [ ] アプリアイコンを作成・設定する。
    2. - [ ] `package.json`に`electron-builder`用の設定を記述する（`appId`, `productName`など）。
    3. - [ ] `yarn build`コマンドでビルドが成功し、インストーラーが生成されることを確認する。

## 3. 次のアクションプラン

### 🎯 直近の作業（フェーズ4-3完了）

#### 4-3. 設定の永続化（✅ 完了）
- **目標:** `electron-store`を使用した設定データの永続化
- **作業内容:**
  - ✅ `electron-store`の設定と初期化
  - ✅ ウィンドウサイズ・位置の保存・復元
  - ✅ 言語設定の永続化
  - ✅ 最近開いたファイルの履歴管理
  - ✅ Mosaicレイアウトの自動保存
  - ✅ 型安全な設定管理API

#### 4-4. UI/UXの最終調整（🚧 部分完了）
- **目標:** より使いやすいインターフェースの実装
- **作業内容:**
  - ✅ **ショートカットキーの実装**: Ctrl+O/S/N対応
  - ✅ **テーマの切り替え機能**: ライト/ダーク/システム自動
  - ✅ **ショートカットヘルプ機能**: F1キー・ヘルプボタン対応 [実装詳細](./phase4-4_shortcut-help-implementation.md)
  - ⏳ **エディタのフォント設定機能**: 未実装
  - ⏳ **設定ダイアログの作成**: 未実装

### 🔄 継続的な改善
- **コードレビュー:** 新機能追加時の品質チェック
- **ドキュメント更新:** 実装詳細の記録と更新（✅ ショートカットヘルプ機能）
- **テスト追加:** 主要機能の動作確認テスト
- **パフォーマンス最適化:** 大きなファイルの処理改善

### 📝 最新の実装（2025年1月10日）
- **テンプレート機能**: ユーザー定義テンプレートの作成・管理・利用機能を実装
  - Phase 5-1: テンプレート選択機能（新規ファイル作成時のテンプレート選択）
  - Phase 5-2: テンプレート管理機能（作成・編集・削除・検索）
  - 8つのカテゴリ分類システム
  - 完全なCRUD操作とElectron IPC統合
  - 736行のテンプレート管理ダイアログ
  - 日本語・英語の完全国際化対応
  - 型安全なTypeScript実装

### 🚀 新規追加計画（フェーズ5: 高度な機能実装）

#### 5-1. テンプレート機能（新規）
- **技術要件:** テンプレートエンジン、ファイル管理システム、UI設計
- **実装範囲:** テンプレート作成・編集・削除・分類・プレビュー・インポート・エクスポート
- **期待効果:** 作業効率の大幅向上、標準化された文書作成

#### 5-2. カラーテーマ切り替え機能（新規）
- **技術要件:** テーマエンジン、カラーパレット管理、CSS-in-JS拡張
- **実装範囲:** プリセットテーマ、カスタムテーマエディタ、リアルタイムプレビュー
- **期待効果:** 個人の好みに応じたカスタマイズ、視認性向上

#### 5-3. 統合設定画面（新規）
- **技術要件:** 設定管理システム、タブ形式UI、設定の永続化拡張
- **実装範囲:** 全設定の一元管理、設定のインポート・エクスポート
- **期待効果:** 設定の管理性向上、ユーザビリティ改善

#### 5-4. タスク管理機能（新規）
- **技術要件:** Markdownパーサー、カンバンボードUI、ドラッグ&ドロップ
- **実装範囲:** タスク抽出、カンバン表示、進捗管理、優先度・期限設定
- **期待効果:** プロジェクト管理機能、生産性向上

### 🎉 フェーズ5 実装完了記録

#### Phase 5-1: テンプレート機能（2025年1月10日完了）
- **実装内容**: テンプレート選択・適用機能
- **主要機能**: 
  - 新規ファイル作成時のテンプレート選択ダイアログ
  - 8つのカテゴリ分類システム
  - 検索・フィルタリング機能
  - リアルタイムプレビュー
  - 完全な国際化対応
- **技術詳細**: [Phase 5-1 実装ログ](./phase5-1_template-functionality-implementation.md)

#### Phase 5-2: テンプレート管理機能（2025年1月10日完了）
- **実装内容**: テンプレート管理ダイアログ
- **主要機能**: 
  - 完全なCRUD操作（作成・読み取り・更新・削除）
  - 736行のテンプレート管理ダイアログ
  - 3つの表示モード（一覧・編集・プレビュー）
  - 検索・フィルタリング機能
  - 設定メニューからのアクセス
- **技術詳細**: [Phase 5-2 実装ログ](./phase5-2_template-management-implementation.md)

### 🎯 技術的な考慮事項

#### 新機能の技術スタック
- **フロントエンド:** React、Material-UI、TSS-React、React DnD（カンバン）
- **データ管理:** electron-store拡張、JSONスキーマ、データ移行
- **パフォーマンス:** 仮想化、メモ化、遅延読み込み
- **アーキテクチャ:** プラグイン化、モジュール分離、型安全性

#### 実装の優先度
1. **Phase 1:** ✅ **完了** - テンプレート機能（生産性向上）
2. **Phase 2:** 統合設定画面（基盤整備）
3. **Phase 3:** カラーテーマ切り替え機能（UI基盤）
4. **Phase 4:** タスク管理機能（高度機能）